<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebPush Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-900 text-gray-100">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 p-6 space-y-6">
      <h1 class="text-2xl font-bold">WebPush Admin</h1>
      <nav class="space-y-4">
        <button onclick="showPanel('register')" class="w-full text-left py-2 px-3 bg-gray-700 hover:bg-gray-600 rounded">Register Token</button>
        <button onclick="showPanel('send')" class="w-full text-left py-2 px-3 bg-gray-700 hover:bg-gray-600 rounded">Send Notification</button>
        <button onclick="showPanel('broadcast')" class="w-full text-left py-2 px-3 bg-gray-700 hover:bg-gray-600 rounded">Broadcast</button>
        <button onclick="showPanel('tokens')" class="w-full text-left py-2 px-3 bg-gray-700 hover:bg-gray-600 rounded">All Tokens</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-10">
      <h2 id="panel-title" class="text-3xl font-bold mb-6">Dashboard</h2>

      <!-- Panels -->
      <div id="register-panel" class="panel hidden">
        <div class="bg-gray-800 p-6 rounded-lg space-y-4 max-w-xl">
          <h3 class="text-xl font-semibold">Register Token</h3>
          <input id="regUser" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="User ID" />
          <input id="regToken" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="FCM Token" />
          <button onclick="registerToken()" class="w-full py-2 bg-blue-600 hover:bg-blue-500 rounded">Register</button>
        </div>
      </div>

      <div id="send-panel" class="panel hidden">
        <div class="bg-gray-800 p-6 rounded-lg space-y-4 max-w-xl">
          <h3 class="text-xl font-semibold">Send Notification</h3>
          <input id="targetUser" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="User ID (optional)" />
          <input id="targetToken" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Token (optional)" />
          <input id="title" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Title" />
          <textarea id="body" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Body"></textarea>
          <input id="apikey" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Admin API Key" />
          <button onclick="sendNotification()" class="w-full py-2 bg-green-600 hover:bg-green-500 rounded">Send</button>
        </div>
      </div>

      <div id="broadcast-panel" class="panel hidden">
        <div class="bg-gray-800 p-6 rounded-lg space-y-4 max-w-xl">
          <h3 class="text-xl font-semibold">Broadcast Notification</h3>
          <input id="btitle" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Broadcast Title" />
          <textarea id="bbody" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Body"></textarea>
          <input id="bapikey" class="w-full px-3 py-2 bg-gray-700 rounded" placeholder="Admin API Key" />
          <button onclick="broadcast()" class="w-full py-2 bg-purple-600 hover:bg-purple-500 rounded">Broadcast</button>
        </div>
      </div>

      <div id="tokens-panel" class="panel hidden">
        <div class="bg-gray-800 p-6 rounded-lg">
          <h3 class="text-xl font-semibold mb-4">Registered Tokens</h3>
          <button onclick="loadTokens()" class="mb-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-500">Refresh</button>
          <table class="w-full text-left">
            <thead>
              <tr>
                <th class="py-2">User ID</th>
                <th class="py-2">Token</th>
                <th class="py-2">Platform</th>
                <th class="py-2">Created</th>
              </tr>
            </thead>
            <tbody id="tokenTable"></tbody>
          </table>
        </div>
      </div>

      <div class="mt-10">
        <h3 class="text-xl font-semibold mb-2">Response</h3>
        <pre id="response" class="bg-gray-800 p-4 rounded max-w-3xl">Ready</pre>
      </div>
    </main>
  </div>

<script>
function showPanel(id){
  document.querySelectorAll('.panel').forEach(p=>p.classList.add('hidden'));
  document.getElementById(id+'-panel').classList.remove('hidden');
  document.getElementById('panel-title').innerText = id.charAt(0).toUpperCase()+id.slice(1);
}

async function registerToken(){
  const userId = regUser.value;
  const token = regToken.value;
  const res = await fetch('/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,token})});
  response.innerText = JSON.stringify(await res.json(),null,2);
}

async function sendNotification(){
  const data = {
    userId: targetUser.value,
    token: targetToken.value,
    title: title.value,
    body: body.value
  };
  const res = await fetch('/send',{ method:'POST', headers:{'Content-Type':'application/json','x-api-key':apikey.value}, body:JSON.stringify(data)});
  response.innerText = JSON.stringify(await res.json(),null,2);
}

async function broadcast(){
  const data = { title: btitle.value, body: bbody.value };
  const res = await fetch('/broadcast',{ method:'POST', headers:{'Content-Type':'application/json','x-api-key':bapikey.value}, body:JSON.stringify(data)});
  response.innerText = JSON.stringify(await res.json(),null,2);
}

async function loadTokens(){
  const res = await fetch('/tokens?api_key='+prompt('Enter Admin API Key')); 
  const json = await res.json();
  response.innerText = JSON.stringify(json,null,2);

  const table = document.getElementById('tokenTable');
  table.innerHTML = '';
  json.tokens.forEach(t => {
    table.innerHTML += `<tr class='border-b border-gray-700'><td class='py-2'>${t.userId}</td><td class='py-2 text-xs'>${t.token}</td><td>${t.platform||'-'}</td><td>${t.created_at}</td></tr>`;
  });
}
</script>
</body>
</html>